# Интеграция AmoCRM с Posiflora

## Обоснование

AmoCRM удобна для работы с клиентами и интернет магазином, Posiflora - для менеджмента цветочного магазина. Задача - заказы с подтвержденной оплатой из AmoCRM передать в Posiflora.

## Структура .env файла

| **Имя переменной** | **Значение**                                    | **Пример**                           |
|--------------------|-------------------------------------------------|--------------------------------------|
| AMO_BASE_URL       | домен AmoCRM                                    | 'https://yourcompany.amocrm.ru'      |
| AMO_REDIRECT_URI   | ссылка на вебхук                                | 'https://yourwebhook.xyz/'           |
| AMO_AUTH_CODE      | код авторизации для интеграции (живет 20 минут) | указан в настройках интеграции       |
| AMO_SECRET_KEY     | секретный ключ интеграции                       | указан в настройках интеграции       |
| AMO_INTEGRATION_ID | ID интеграции                                   | указан в настройках интеграции       |
| AMO_REFRESH_TOKEN  | Refresh токен для AmoCRM (живет 24 часа)        | записывается в файл автоматически    |
| AMO_ACCESS_TOKEN   | Access токен для AmoCRM (живет 24 часа)         | записывается в файл автоматически    |
| POSIFLORA_BASE_URL | адрес Posiflora                                 | 'https://yourcompany.posiflora.com/' |
| POSIFLORA_USERNAME | Логин Posiflora                                 | your.username                        |
| POSIFLORA_PASSWORD | Пароль Posiflora                                | yu0r_pa$$w0rD                        |

## Инструкция

1. Создать триггер на вебхук в воронке AmoCRM с параметром "При переходе в этап". Указать url скрипта
2. Содать внешнюю интеграцию, внести секретный ключ, ID интеграции и код авторизации в .env файл
3. Запустить скрипт на создание первичной авторизации, он запишет Refresh и Access токены. Далее он каждый день будет обновлять их
4. Создавать кастомные поля в соответствии и полями в посифлоре